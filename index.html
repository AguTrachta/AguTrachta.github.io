<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Speech to Text</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Speech to Text</h1>
    <button id="start-recording">Start Recording</button>
    <button id="stop-recording" disabled>Stop Recording</button>
    <p id="transcript"></p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-functions.js"></script>

  <script>
    // ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID",
      measurementId: "YOUR_MEASUREMENT_ID"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const functions = firebase.functions();

    let mediaRecorder;
    let audioChunks = [];

    document.getElementById('start-recording').addEventListener('click', async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = event => {
        audioChunks.push(event.data);
      };

      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        const reader = new FileReader();

        reader.onloadend = async () => {
          const base64AudioMessage = reader.result.split(',')[1];
          await callSpeechToText(base64AudioMessage);
        };

        reader.readAsDataURL(audioBlob);
      };

      mediaRecorder.start();
      document.getElementById('start-recording').disabled = true;
      document.getElementById('stop-recording').disabled = false;
    });

    document.getElementById('stop-recording').addEventListener('click', () => {
      mediaRecorder.stop();
      document.getElementById('start-recording').disabled = false;
      document.getElementById('stop-recording').disabled = true;
    });

    async function callSpeechToText(audioBase64) {
      const speechToText = functions.httpsCallable('speechToText');
      try {
        const result = await speechToText({ audio: audioBase64 });
        document.getElementById('transcript').innerText = result.data;
      } catch (error) {
        console.error("Error calling speechToText function:", error);
      }
    }
  </script>
</body>
</html>
